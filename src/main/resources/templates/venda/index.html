<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">

<head>
	<!-- Meta tags ObrigatÃ³rias -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


	<meta content="" name="description">
	<meta content="" name="keywords">
	<!-- Favicons -->
	<link href="" rel="icon" th:href="@{/img/favicon.png}">
	<link href="" rel="apple-touch-icon" th:href="@{/img/apple-touch-icon.png}">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
		integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<!-- Google Fonts -->
	<link
		href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
		rel="stylesheet">
	<!-- Vendor CSS Files -->
	<link href="" rel="stylesheet" th:href="@{/vendor/aos/aos.css}">
	<link href="" rel="stylesheet" th:href="@{/vendor/bootstrap/css/bootstrap.min.css}">
	<link href="" rel="stylesheet" th:href="@{/vendor/bootstrap-icons/bootstrap-icons.css}">
	<link href="" rel="stylesheet" th:href="@{/vendor/boxicons/css/boxicons.min.css}">
	<link href="" rel="stylesheet" th:href="@{/vendor/glightbox/css/glightbox.min.css}">
	<link href="" rel="stylesheet" th:href="@{/vendor/swiper/swiper-bundle.min.css}">
	<!-- Template Main CSS File -->
	<link href="" rel="stylesheet" th:href="@{/css/style.css}">

	<title>Cadastro Venda</title>
</head>

<body>

	<header th:include="fragmentos::header"></header>
	<main class="container">
		<form class="formulario" method="post" enctype="multipart/form-data" th:action="@{/produto/salvar}"
			th:object="${produto}">
			<h1>Venda</h1>

			<div class="form-group mb-2 col-md-8">
				<label for="exampleInputPassword1">Cliente</label>
				<select class="form-control" id="idcliente">
					<option value=""> Selecione um Cliente...</option>
					<option th:each="item:${listacliente}" th:value="${item.id}" th:text="${item.nome}">
					</option>
				</select>
			</div>
			<div class="form-group mb-2 col-md-8">
				<label for="exampleInputPassword1">Produto</label>
				<select class="form-control" id="idproduto">
					<option value=""> Selecione um Produto...</option>
					<option th:each="item:${listaproduto}" th:value="${item.id}" th:text="${item.nome}">
					</option>
				</select>
			</div>
		</form>


		<div class="row" style="margin-top: 20px; margin-left: 30px; margin-bottom: 30px;">
			<div class="col-md-4">
				<input type="number" id="txtquantidade" class="form-control" />
			</div>
			<div class="col-md-4">
				<a id="btnincluirproduto" class="btn btn-info" href="#">INCLUIR PRODUTO</a>
			</div>

		</div>

		<table class="table table-striped" style="margin-bottom: 30px;">
			<thead>
				<tr>
					<th scope="col">Cliente</th>
					<th scope="col">Cod Produto</th>
					<th scope="col">Produto</th>
					<th scope="col">Quantidade</th>
					<th scope="col">Valor unitario</th>
					<th scope="col">Total</th>
					<th scope="col">Excluir</th>
				</tr>
			</thead>
			<tbody id="dadostabela">

			</tbody>

			<table style="display: none;">
				<tr id="linhamodelo">
					<td class="cliente"></td>
					<td class="codigo"></td>
					<td class="produto"></td>
					<td class="quantidade">
						<select class="quantidadeproduto">
							<option value="1">1</option>
							<option value="2">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8">8</option>
							<option value="9">9</option>
							<option value="10">10</option>
						</select>
					</td>
					<td class="valorunitario"></td>
					<td class="total"></td>
					<td class="excluir">
						<a href="#" class="btnexcluir">Excluir</a>
					</td>
				</tr>
			</table>

		</table>
		<h3>Total Geral</h3>
		<span id="totalgeral"></span>
		<div style="margin-top: 10px; margin-bottom: 10px;">
			<button class="btn btn-info" id="salvarVenda">SALVAR</button>
		</div>
	</main>

	<footer th:include="fragmentos::footer"></footer>

</body>


<!-- JavaScript (Opcional) -->
<!-- jQuery primeiro, depois Popper.js, depois Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"
	integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
	integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
	crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
	integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
	crossorigin="anonymous"></script>

<script>

	$(document).ready(function () {

		$("#btnincluirproduto").click(function () {
			incluirProduto();
		});


	});


	function incluirProduto() {


		var linha = $("#linhamodelo").clone();
		linha.attr("id", "");

		$(linha).find(".cliente").text($("#idcliente option:selected").text());

		$(linha).find(".codigo").text($("#idproduto").val());

		$(linha).find(".produto").text($("#idproduto option:selected").text());

		$(linha).find(".quantidadeproduto").val($("#txtquantidade").val());

		//alterando a quantidade do produto 
		$(linha).find(".quantidadeproduto").change(function () {
			alterarProduto(linha);

		});

		$(linha).find(".btnexcluir").click(function () {
			excluirProduto(linha);
		})

		$("#dadostabela").append(linha);


		buscarProduto($("#idproduto").val(), linha);


	}


	function calcularTotal() {
		var total = 0;


		var preco = $("#dadostabela .total").map(function () {
			return parseFloat($(this).text());
		}).get();


		for (var i = 0; i < preco.length; i++) {
			total += preco[i];
		}

		$("#totalgeral").text(total);
	}

	function excluirProduto(linha) {

		$(linha).remove();
		calcularTotal();
	}

	function alterarProduto(linha) {

		console.log(linha)

		var valorunitarios = $(linha).find(".valorunitario").text();
		var qtde = $(linha).find(".quantidadeproduto").val();
		$(linha).find(".total").text(valorunitarios * qtde);
		calcularTotal();
	}

	function buscarProduto(id, linha) {

		$.get("http://localhost:8080/produto/getProduto/" + id, function (resultado) {

			var qtde = $(linha).find(".quantidadeproduto").val();

			$(linha).find(".total").text(resultado.valor * qtde);
			$(linha).find(".valorunitario").text(resultado.valor);
			calcularTotal();

		});

	}

	

	/*
				function salvarProduto() {
			
					var model = {
						id: "null",
						nome: "",
						valor: "",
						estoque: ".com",
						categoria: "",
						imagem: "",
			
						
					};
					$.ajax({
						type: "POST",
						url: "http://localhost:8080/venda/salvarProduto",
						contentType: "application/json; charset=utf-8",
						data: JSON.stringify(model),
						dataType: "json",
						success: function (jsonResult) {
							console.log(jsonResult);
						},
						failure: function (response) {
							alert("Erro ao carregar os dados: " + response);
						}
					});
			
				} */

</script>
</body>

</html>